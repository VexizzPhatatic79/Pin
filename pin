local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hasBomb = false -- Flag to check if player has the bomb
local bombHolder = nil -- To keep track of who has the bomb
local bombTime = 10 -- Time before the bomb explodes (in seconds)

-- UI setup
local screenGui = Instance.new("ScreenGui", player.PlayerGui)

-- Title setup (Phoela)
local titleLabel = Instance.new("TextLabel", screenGui)
titleLabel.Position = UDim2.new(0.5, -100, 0, 10) -- Centered at top
titleLabel.Size = UDim2.new(0, 200, 0, 50)
titleLabel.Text = "Phoela"
titleLabel.TextColor3 = Color3.new(1, 1, 1) -- White text
titleLabel.BackgroundTransparency = 1 -- Transparent background
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextScaled = true

-- Alert setup
local alertLabel = Instance.new("TextLabel", screenGui)
alertLabel.Position = UDim2.new(0.5, -100, 0.5, 0)
alertLabel.Size = UDim2.new(0, 200, 0, 50)
alertLabel.Text = ""
alertLabel.TextColor3 = Color3.new(1, 0, 0) -- Red text for alert
alertLabel.BackgroundTransparency = 1
alertLabel.Font = Enum.Font.SourceSansBold
alertLabel.TextScaled = true
alertLabel.Visible = false -- Hidden initially

-- Throw Button setup
local throwButton = Instance.new("TextButton", screenGui)
throwButton.Position = UDim2.new(0.5, -50, 0.6, 0)
throwButton.Size = UDim2.new(0, 100, 0, 50)
throwButton.Text = "ပစ်မည်"
throwButton.BackgroundColor3 = Color3.new(1, 1, 0) -- Yellow
throwButton.Visible = false -- Hidden initially

-- Function to find the closest player
local function getClosestPlayer()
    local closestPlayer = nil
    local minDistance = math.huge

    for _, otherPlayer in pairs(game.Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character and otherPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (character.HumanoidRootPart.Position - otherPlayer.Character.HumanoidRootPart.Position).Magnitude
            if distance < minDistance then
                minDistance = distance
                closestPlayer = otherPlayer
            end
        end
    end
    return closestPlayer
end

-- Function to pass the bomb to the closest player
local function passBombToPlayer()
    if hasBomb then
        local closestPlayer = getClosestPlayer()
        if closestPlayer and closestPlayer.Character and closestPlayer.Character:FindFirstChild("HumanoidRootPart") then
            -- Transfer the bomb
            local bomb = player.Backpack:FindFirstChild("Bomb")
            if bomb then
                bomb.Parent = closestPlayer.Backpack
                bombHolder = closestPlayer -- Update bombHolder to the new player
                alertLabel.Text = "" -- Hide alert
                alertLabel.Visible = false
                hasBomb = false
                throwButton.Visible = false -- Hide the button after passing the bomb
            end
        end
    end
end

-- Function to handle bomb timer
local function startBombTimer()
    while hasBomb do
        wait(1)
        bombTime = bombTime - 1
        if bombTime <= 0 then
            -- Bomb explodes if time runs out
            if bombHolder == player then
                character.Humanoid:TakeDamage(character.Humanoid.MaxHealth) -- Kill the player with the bomb
            end
            hasBomb = false
            break
        end
    end
end

-- Function to detect Bomb being added to player's inventory
player.Backpack.ChildAdded:Connect(function(child)
    if child.Name == "Bomb" then
        hasBomb = true
        bombHolder = player
        alertLabel.Text = "ဗုံးရနေပါပြီ!"
        alertLabel.Visible = true
        bombTime = 10 -- Reset bomb timer
        startBombTimer()
        throwButton.Visible = true -- Show the throw button when player gets the bomb
    end
end)

-- Function to detect Bomb being removed from player's inventory
player.Backpack.ChildRemoved:Connect(function(child)
    if child.Name == "Bomb" then
        hasBomb = false
        alertLabel.Visible = false -- Hide the alert if Bomb is removed
        throwButton.Visible = false -- Hide the throw button if Bomb is removed
    end
end)

-- Button to throw the bomb to the closest player
throwButton.MouseButton1Click:Connect(function()
    if hasBomb then
        passBombToPlayer()
    end
end)
